{% comment %}
  Renders a product media modal. Also see 'product-media-gallery'

  Accepts:
  - product: {Object} Product liquid object
  - variant_images: {Array} Product images associated with a variant

  Usage:
  {% render 'product-media-modal' %}
{% endcomment %}

<product-modal id="ProductModal-{{ section.id }}" class="product-media-modal media-modal">
  <div
    class="product-media-modal__dialog color-{{ section.settings.color_scheme }} gradient"
    role="dialog"
    aria-label="{{ 'products.modal.label' | t }}"
    aria-modal="true"
    tabindex="-1"
  >
    <button
      id="ModalClose-{{ section.id }}"
      type="button"
      class="product-media-modal__toggle"
      aria-label="{{ 'accessibility.close' | t }}"
    >
      {{ 'icon-close.svg' | inline_asset_content }}
    </button>

    <div
      class="product-media-modal__content color-{{ section.settings.color_scheme }} gradient"
      role="document"
      aria-label="{{ 'products.modal.label' | t }}"
      tabindex="0"
    >
      {%- comment -%} Reuse the media gallery structure inside modal for navigation and thumbnails {%- endcomment -%}
      <media-gallery id="ModalGallery-{{ section.id }}" aria-label="{{ 'products.product.media.gallery_viewer' | t }}">
        <div id="GalleryStatus-Modal-{{ section.id }}" class="visually-hidden" role="status"></div>
        <slider-component id="GalleryViewer-Modal-{{ section.id }}" class="slider-mobile-gutter">
          <ul
            id="Slider-Modal-Gallery-{{ section.id }}"
            class="product__media-list contains-media grid grid--peek list-unstyled slider slider--mobile"
            role="list"
          >
            {%- if product.selected_or_first_available_variant.featured_media != null -%}
                {%- assign featured_media = product.selected_or_first_available_variant.featured_media -%}
                <li
                  id="Modal-Slide-{{ section.id }}-{{ featured_media.id }}"
                  class="product__media-item grid__item slider__slide is-active"
                  data-media-id="{{ featured_media.id }}"
                >
                  {% render 'product-media', media: featured_media, loop: section.settings.enable_video_looping, variant_image: section.settings.hide_variants %}
                </li>
              {%- endif -%}

              {%- for media in product.media -%}
                {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
                  <li
                    id="Modal-Slide-{{ section.id }}-{{ media.id }}"
                    class="product__media-item grid__item slider__slide"
                    data-media-id="{{ media.id }}"
                  >
                    {% render 'product-media', media: media, loop: section.settings.enable_video_looping, variant_image: false %}
                  </li>
                {%- endunless -%}
              {%- endfor -%}
          </ul>

          <div class="slider-buttons quick-add-hidden">
            <button
              type="button"
              class="slider-button slider-button--prev"
              name="previous"
              aria-label="{{ 'general.slider.previous_slide' | t }}"
            >
              <span class="svg-wrapper">{{- 'icon-caret.svg' | inline_asset_content -}}</span>
            </button>
            <div class="slider-counter caption">
              <span class="slider-counter--current">1</span>
              <span aria-hidden="true"> / </span>
              <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
              <span class="slider-counter--total">{{ product.media.size }}</span>
            </div>
            <button
              type="button"
              class="slider-button slider-button--next"
              name="next"
              aria-label="{{ 'general.slider.next_slide' | t }}"
            >
              <span class="svg-wrapper">{{- 'icon-caret.svg' | inline_asset_content -}}</span>
            </button>
          </div>
        </slider-component>

        {%- if product.media.size > 1 -%}
          <slider-component id="GalleryThumbnails-Modal-{{ section.id }}" class="thumbnail-slider slider-mobile-gutter">
            <button type="button" class="slider-button slider-button--prev" name="previous" aria-label="{{ 'general.slider.previous_slide' | t }}" data-step="3">
              <span class="svg-wrapper">{{- 'icon-caret.svg' | inline_asset_content -}}</span>
            </button>
            <ul id="Slider-Modal-Thumbnails-{{ section.id }}" class="thumbnail-list list-unstyled slider slider--mobile">
              {%- for media in product.media -%}
                <li class="thumbnail-list__item slider__slide" data-target="{{ media.id }}" data-media-position="{{ forloop.index }}">
                  <button class="thumbnail" aria-label="{{ 'products.product.media.load_image' | t: index: forloop.index }}" aria-controls="GalleryViewer-Modal-{{ section.id }}">
                    {{ media.preview_image | image_url: width: 416 | image_tag: loading: 'lazy', alt: media.alt }}
                  </button>
                </li>
              {%- endfor -%}
            </ul>
            <button type="button" class="slider-button slider-button--next" name="next" aria-label="{{ 'general.slider.next_slide' | t }}" data-step="3">
              <span class="svg-wrapper">{{- 'icon-caret.svg' | inline_asset_content -}}</span>
            </button>
          </slider-component>
        {%- endif -%}
      </media-gallery>
    </div>
  </div>
</product-modal>
